{% extends 'base.html' %}

{% block heading %}
<h1>Current State of the Classroom</h1>
{% endblock %}

{% block content %}
  <div id="attendanceDiv"></div>
  <div id="studentDiv"></div>
{% endblock %}

{% block script %}
<script>

function getOverallAttendance(){
  var objData = {
    'time_range': $('#timeRange').val()
  };
  getData('/get_overall_attendance', objData, function(data){
    console.log(data['overall_attendance'], data['num_student']);
    num_student = data['num_student'];
    if(data['overall_attendance'].length == 0){
      num_attendance = 0;
    }else{
      num_attendance = data['overall_attendance'][data['overall_attendance'].length-1]['student_id'].length;
    }
    $('#attendanceDiv').html('<p>Attendance: '+ num_attendance +'/'+ num_student +'</p>')
  });
};

function getStudents(){
  var objData = {
    'time_range': $('#timeRange').val()
  };
  getData('/get_students', objData, function(data){
    console.log(data);
    var studentHtml = '<ul>';
    for(var student of data){
      student_id = student["student_id"];
      studentHtml += '<li><a href=/std/'+ student_id +'>'+ student_id + ' ' + student['student_name'] + '</a>: ';
      if(student['is_present']){
        studentHtml += '<span class="present">Present</span>';
      }
      else{
        studentHtml += '<span class="absent">Absent</span>';
      }
      studentHtml += '</li>';

    }
    studentHtml += '</ul>';
    $('#studentDiv').html(studentHtml);
  });
};

function getEverything(){
  $('#timeRangeVal').html($('#timeRange').val());
  getOverallAttendance();
  getStudents();
}

$(document).ready(function(){
    $('#attendanceDiv').html('<p>Attendance: ?/?</p>')

    getEverything();

    // $('#refresh').off('click');
    // $('#refresh').on('click', function(){
    //   getEverything();
    // });
});
</script>
{% endblock %}